@model ClinicSystem2.Controllers.DashboardViewModel

@{
    ViewData["Title"] = "Dashboard";
}

<style>
    /* Custom styles for a more modern and professional look */
    .card-modern {
        border: none;
        border-radius: 0.75rem; /* Slightly rounded corners */
        overflow: hidden;
        transition: transform 0.3s ease, box-shadow 0.3s ease;
    }

        .card-modern:hover {
            transform: translateY(-5px); /* Subtle lift effect on hover */
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.08);
        }

    /* Gradient Header for Stats Cards - A professional touch */
    .card-header-primary {
        background: linear-gradient(45deg, #1c3d7c, #2a57aa); /* Dark/Deep Blue Gradient */
        color: white;
    }

    .card-header-success {
        background: linear-gradient(45deg, #0d7350, #149a6b); /* Deep Green Gradient */
        color: white;
    }

    .card-header-info {
        background: linear-gradient(45deg, #0f6c77, #139ea7); /* Teal Gradient */
        color: white;
    }

    .stat-icon {
        opacity: 0.7; /* Make icon slightly less dominant */
    }

    .list-group-item-appointment {
        border-left: 5px solid;
        margin-bottom: 8px;
        border-radius: 0.5rem;
        padding: 15px;
    }

        .list-group-item-appointment.border-primary {
            border-color: #2a57aa;
        }

        .list-group-item-appointment.border-warning {
            border-color: #d58d24;
        }

        .list-group-item-appointment.border-success {
            border-color: #149a6b;
        }

        .list-group-item-appointment.border-danger {
            border-color: #dc3545;
        }
</style>

<div class="row mb-5">
    <div class="col-12">
        <h1 class="h2 mb-1 text-dark">✨ Clinic Dashboard</h1>
        <p class="text-muted">Quick overview and statistics for the Clinic Management System</p>
    </div>
</div>

<div class="row mb-5">

    <div class="col-xl-4 col-md-6 mb-4">
        <div class="card card-modern shadow-sm h-100">
            <div class="card-header card-header-primary text-center">
                <div class="text-xs font-weight-bold text-uppercase p-1">
                    Total Patients
                </div>
            </div>
            <div class="card-body">
                <div class="row no-gutters align-items-center">
                    <div class="col mr-2">
                        <div class="h3 mb-0 font-weight-bolder text-dark">@Model.TotalPatients</div>
                    </div>
                    <div class="col-auto">
                        <i class="fas fa-users fa-3x text-primary stat-icon"></i>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="col-xl-4 col-md-6 mb-4">
        <div class="card card-modern shadow-sm h-100">
            <div class="card-header card-header-success text-center">
                <div class="text-xs font-weight-bold text-uppercase p-1">
                    Total Doctors
                </div>
            </div>
            <div class="card-body">
                <div class="row no-gutters align-items-center">
                    <div class="col mr-2">
                        <div class="h3 mb-0 font-weight-bolder text-dark">@Model.TotalDoctors</div>
                    </div>
                    <div class="col-auto">
                        <i class="fas fa-user-md fa-3x text-success stat-icon"></i>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="col-xl-4 col-md-6 mb-4">
        <div class="card card-modern shadow-sm h-100">
            <div class="card-header card-header-info text-center">
                <div class="text-xs font-weight-bold text-uppercase p-1">
                    Today's Appointments
                </div>
            </div>
            <div class="card-body">
                <div class="row no-gutters align-items-center">
                    <div class="col mr-2">
                        <div class="h3 mb-0 font-weight-bolder text-dark">@Model.TodayAppointments</div>
                    </div>
                    <div class="col-auto">
                        <i class="fas fa-calendar-day fa-3x text-info stat-icon"></i>
                    </div>
                </div>
            </div>
        </div>
    </div>

</div>

<div class="row">
    <div class="col-xl-6 col-lg-6">
        <div class="card card-modern shadow mb-4">
            <div class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
                <h6 class="m-0 font-weight-bold text-primary">Upcoming Appointments</h6>
                <a asp-action="TodayAppointments" class="btn btn-sm btn-outline-primary shadow-sm">View All <i class="fas fa-arrow-right ml-1"></i></a>
            </div>
            <div class="card-body">
                @if (Model.UpcomingAppointments.Any())
                {
                    <div class="list-group list-group-flush">
                        @foreach (var appointment in Model.UpcomingAppointments.Take(5)) // Show top 5
                        {
                            var statusClass = GetStatusBadgeClass(appointment.Status);
                            <div class="list-group-item list-group-item-appointment border-@statusClass d-flex justify-content-between align-items-center">
                                <div>
                                    <h6 class="mb-1 font-weight-bold text-dark">@appointment.PatientName</h6>
                                    <small class="text-muted">Dr. @appointment.DoctorName - @appointment.Specialty</small>
                                    <br>
                                    <small class="text-info font-weight-bold"><i class="far fa-clock mr-1"></i> @appointment.AppointmentDate.ToString("MMM dd, yyyy HH:mm")</small>
                                </div>
                                <span class="badge badge-pill badge-@statusClass p-2">@appointment.Status</span>
                            </div>
                        }
                    </div>
                }
                else
                {
                    <p class="text-muted text-center py-3">No upcoming appointments currently scheduled.</p>
                }
            </div>
        </div>
    </div>

    <div class="col-xl-6 col-lg-6">
        <div class="card card-modern shadow mb-4">
            <div class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
                <h6 class="m-0 font-weight-bold text-success">Available Doctors</h6>
                <a asp-action="AvailableSlots" class="btn btn-sm btn-outline-success shadow-sm">View All <i class="fas fa-arrow-right ml-1"></i></a>
            </div>
            <div class="card-body">
                @if (Model.AvailableDoctors.Any())
                {
                    <div class="list-group list-group-flush">
                        @foreach (var doctor in Model.AvailableDoctors.Take(5)) // Show top 5
                        {
                            <div class="list-group-item d-flex justify-content-between align-items-center">
                                <div>
                                    <h6 class="mb-1 font-weight-bold">@doctor.DoctorName</h6>
                                    <small class="text-muted"><i class="fas fa-tag mr-1"></i> @doctor.Specialty</small>
                                </div>
                                <span class="badge badge-success badge-pill p-2"><i class="fas fa-check-circle mr-1"></i> Available</span>
                            </div>
                        }
                    </div>
                }
                else
                {
                    <p class="text-muted text-center py-3">No doctors currently available.</p>
                }
            </div>
        </div>
    </div>
</div>

<div class="row mt-4">
    <div class="col-lg-6">
        <div class="card card-modern shadow mb-4">
            <div class="card-header py-3">
                <h6 class="m-0 font-weight-bold text-primary">Quick Actions</h6>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <a asp-action="QuickRegister" class="btn btn-primary btn-lg btn-block shadow-sm">
                            <i class="fas fa-user-plus mr-2"></i> Register New Patient
                        </a>
                    </div>
                    <div class="col-md-6 mb-3">
                        <a asp-asp-controller="Appointment" asp-action="create" class="btn btn-success btn-lg btn-block shadow-sm">
                            <i class="fas fa-calendar-plus mr-2"></i> Book Appointment
                        </a>
                    </div>
                    <div class="col-md-6 mb-3">
                        <a asp-action="TodayAppointments" class="btn btn-info btn-lg btn-block shadow-sm">
                            <i class="fas fa-list mr-2"></i> Today's Schedule
                        </a>
                    </div>
                    <div class="col-md-6 mb-3">
                        <a asp-action="FinancialOverview" class="btn btn-secondary btn-lg btn-block shadow-sm">
                            <i class="fas fa-chart-bar mr-2"></i> View Reports
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="col-lg-6">
        <div class="card card-modern shadow mb-4 h-100">
            <div class="card-header py-3">
                <h6 class="m-0 font-weight-bold text-secondary">Announcements & Activity</h6>
            </div>
            <div class="card-body d-flex align-items-center justify-content-center">
                <p class="text-muted text-center">
                    <i class="fas fa-bell fa-2x mb-2 text-secondary"></i><br>
                    You can add recent system activity logs or charts here.
                </p>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        // Auto-refresh dashboard every 5 minutes (300000ms)
        setInterval(function() {
            // console.log("Refreshing dashboard...");
            location.reload();
        }, 300000);
    </script>
}

@functions {
    private string GetStatusBadgeClass(string status)
    {
        return status?.ToLower() switch
        {
            "completed" => "success",
            "confirmed" => "primary",
            "pending" => "warning",
            "cancelled" => "danger",
            _ => "secondary"
        };
    }
}