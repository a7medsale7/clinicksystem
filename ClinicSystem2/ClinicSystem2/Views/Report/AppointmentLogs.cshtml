@model IEnumerable<ClinicSystem2.Models.AppointmentLog>

@{
    ViewData["Title"] = "Appointment Logs";
}

<div class="d-flex justify-content-between align-items-center mb-4">
    <h1>Appointment Logs</h1>
    <div>
        <a asp-action="Financial" class="btn btn-outline-primary">Financial Report</a>
        <a asp-action="MonthlyRevenue" class="btn btn-outline-info">Monthly Revenue</a>
    </div>
</div>

<!-- Summary Card -->
<div class="row mb-4">
    <div class="col-md-12">
        <div class="card text-white bg-dark">
            <div class="card-body text-center">
                <h4 class="mb-0">Total Log Entries: @Model.Count()</h4>
                <p class="mb-0">System activity tracking for appointments</p>
            </div>
        </div>
    </div>
</div>

<!-- Logs Table -->
<div class="card">
    <div class="card-header">
        <h5 class="mb-0">Appointment Activity Logs</h5>
    </div>
    <div class="card-body">
        @if (Model.Any())
        {
            <div class="table-responsive">
                <table class="table table-striped table-hover">
                    <thead class="table-dark">
                        <tr>
                            <th>Log Date</th>
                            <th>Appointment ID</th>
                            <th>Action Type</th>
                            <th>Log Message</th>
                            <th>User</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var log in Model)
                        {
                            <tr>
                                <td>@log.LogDate.ToString()</td>
                                <td>
                                    @if (log.AppointmentId.HasValue)
                                    {
                                        <span class="badge bg-primary">#@log.AppointmentId.Value</span>
                                    }
                                    else
                                    {
                                        <span class="text-muted">N/A</span>
                                    }
                                </td>
                                <td>
                                    @{
                                        var actionType = ExtractActionType(log.LogMessage);
                                    }
                                    <span class="badge @GetActionBadgeClass(actionType)">@actionType</span>
                                </td>
                                <td>@log.LogMessage</td>
                                <td>@log.LogMessage</td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
        }
        else
        {
            <div class="alert alert-info text-center">
                <h4>No appointment logs found</h4>
                <p class="mb-0">There are no appointment activity logs to display.</p>
            </div>
        }
    </div>
</div>

@functions {
    private string GetActionBadgeClass(string action)
    {
        if (string.IsNullOrEmpty(action))
            return "bg-primary";

        return action.ToLower() switch
        {
            "create" or "created" => "bg-success",
            "update" or "updated" => "bg-warning",
            "delete" or "deleted" => "bg-danger",
            "cancel" or "cancelled" => "bg-secondary",
            "complete" or "completed" => "bg-info",
            "reschedule" or "rescheduled" => "bg-primary",
            _ => "bg-dark"
        };
    }

    private string ExtractActionType(string logMessage)
    {
        if (string.IsNullOrEmpty(logMessage))
            return "Unknown";

        var message = logMessage.ToLower();

        if (message.Contains("created") || message.Contains("create")) return "Created";
        if (message.Contains("updated") || message.Contains("update")) return "Updated";
        if (message.Contains("deleted") || message.Contains("delete")) return "Deleted";
        if (message.Contains("cancelled") || message.Contains("cancel")) return "Cancelled";
        if (message.Contains("completed") || message.Contains("complete")) return "Completed";
        if (message.Contains("rescheduled") || message.Contains("reschedule")) return "Rescheduled";

        return "Other";
    }
}